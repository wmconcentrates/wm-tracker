<!DOCTYPE html>
<!-- v1.3 - Clean build with cache control -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>White Mousse Blog - Serving the Terps</title>

    <!-- SEO Meta Tags -->
    <meta name="description" content="Behind the scenes at White Mousse Concentrates. Strain spotlights, extraction insights, and the latest drops from Colorado's premier concentrate producer.">
    <meta name="keywords" content="cannabis concentrates, live resin, terpenes, Colorado cannabis, wholesale concentrates, extraction, shatter, wax, budder">
    <meta name="author" content="White Mousse Concentrates">
    <meta name="robots" content="index, follow">

    <!-- Open Graph / Social -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="White Mousse Blog - Serving the Terps">
    <meta property="og:description" content="Behind the scenes at White Mousse Concentrates. Strain spotlights, extraction insights, and the latest drops.">
    <meta property="og:url" content="https://blog.whitemousse.com">
    <meta property="og:site_name" content="White Mousse Concentrates">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Work+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">

    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        :root {
            --bg-primary: #000000;
            --bg-secondary: #0a0a0a;
            --bg-tertiary: #141414;
            --bg-card: #0d0d0d;
            --accent-purple: #bf00ff;
            --accent-green: #39ff14;
            --accent-blue: #00f0ff;
            --accent-orange: #ff6b00;
            --accent-red: #ff0055;
            --accent-pink: #ff10f0;
            --accent-yellow: #ffff00;
            --text-primary: #ffffff;
            --text-secondary: #888888;
            --text-muted: #555555;
            --border: #222222;
            --glow-green: 0 0 20px rgba(57, 255, 20, 0.5);
            --glow-pink: 0 0 20px rgba(255, 16, 240, 0.5);
            --glow-blue: 0 0 20px rgba(0, 240, 255, 0.5);
            --glow-purple: 0 0 20px rgba(191, 0, 255, 0.5);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Work Sans', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        .header {
            background: linear-gradient(135deg, var(--accent-pink), var(--accent-purple), var(--accent-blue));
            padding: 20px 40px;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 0 40px rgba(255, 16, 240, 0.4);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
            text-decoration: none;
            color: white;
        }

        .logo-img {
            height: 50px;
            width: auto;
            filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.5));
        }

        .logo span {
            font-family: 'Space Mono', monospace;
            font-size: 0.9rem;
            opacity: 0.9;
            display: block;
            font-weight: 400;
            letter-spacing: 3px;
        }

        .nav { display: flex; gap: 30px; align-items: center; }

        .nav a {
            color: white;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s;
            padding: 8px 16px;
            border-radius: 8px;
        }

        .nav a:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .owner-btn {
            background: rgba(0, 0, 0, 0.3) !important;
            border: 2px solid rgba(255, 255, 255, 0.3);
            font-size: 0.85rem;
        }

        .hero {
            padding: 80px 40px;
            text-align: center;
            background: radial-gradient(ellipse at top, var(--bg-tertiary) 0%, var(--bg-primary) 70%);
            border-bottom: 1px solid var(--border);
        }

        .hero h1 {
            font-family: 'Space Mono', monospace;
            font-size: 3rem;
            margin-bottom: 20px;
            background: linear-gradient(90deg, var(--accent-green), var(--accent-blue), var(--accent-pink));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .hero p {
            font-size: 1.3rem;
            color: var(--text-secondary);
            max-width: 600px;
            margin: 0 auto;
        }

        .main {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px;
        }

        .categories {
            display: flex;
            gap: 15px;
            margin-bottom: 40px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .category-btn {
            padding: 12px 24px;
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: 30px;
            color: var(--text-primary);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .category-btn:hover, .category-btn.active {
            border-color: var(--accent-green);
            box-shadow: var(--glow-green);
            color: var(--accent-green);
        }

        .blog-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 30px;
        }

        .blog-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            overflow: hidden;
            transition: all 0.3s;
            cursor: pointer;
        }

        .blog-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent-purple);
            box-shadow: 0 10px 40px rgba(191, 0, 255, 0.2);
        }

        .blog-card-image {
            height: 200px;
            background: linear-gradient(135deg, var(--bg-tertiary), var(--bg-secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            position: relative;
        }

        .blog-card-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .blog-card-category {
            position: absolute;
            top: 15px;
            left: 15px;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .blog-card-category.drops { background: var(--accent-pink); }
        .blog-card-category.strains { background: var(--accent-purple); }
        .blog-card-category.education { background: var(--accent-blue); }
        .blog-card-category.behind-scenes { background: var(--accent-orange); }
        .blog-card-category.news { background: var(--accent-green); color: black; }
        .blog-card-category.update { background: var(--accent-yellow); color: black; }

        .blog-card-content { padding: 25px; }

        .blog-card-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .blog-card-excerpt {
            color: var(--text-secondary);
            font-size: 0.95rem;
            margin-bottom: 15px;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .blog-card-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .featured-post {
            background: var(--bg-card);
            border: 2px solid var(--accent-green);
            border-radius: 20px;
            overflow: hidden;
            margin-bottom: 50px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            box-shadow: var(--glow-green);
        }

        .featured-post-image {
            min-height: 400px;
            background: linear-gradient(135deg, var(--bg-tertiary), var(--bg-secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 6rem;
        }

        .featured-post-content {
            padding: 50px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .featured-label {
            color: var(--accent-green);
            font-weight: 700;
            font-size: 0.85rem;
            letter-spacing: 2px;
            margin-bottom: 15px;
        }

        .featured-post-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .featured-post-excerpt {
            color: var(--text-secondary);
            font-size: 1.1rem;
            margin-bottom: 25px;
        }

        .read-more-btn {
            display: inline-block;
            padding: 14px 30px;
            background: linear-gradient(135deg, var(--accent-green), var(--accent-blue));
            border: none;
            border-radius: 10px;
            color: black;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            align-self: flex-start;
        }

        .read-more-btn:hover {
            transform: scale(1.05);
            box-shadow: var(--glow-green);
        }

        /* Single Post */
        .single-post {
            display: none;
            max-width: 900px;
            margin: 0 auto;
        }

        .single-post.active { display: block; }

        .single-post-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .single-post-category {
            display: inline-block;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            margin-bottom: 20px;
            background: var(--accent-purple);
        }

        .single-post-title {
            font-size: 2.8rem;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .single-post-meta {
            color: var(--text-secondary);
            display: flex;
            gap: 30px;
            justify-content: center;
        }

        .single-post-body {
            font-size: 1.15rem;
            line-height: 1.8;
        }

        .single-post-body p { margin-bottom: 20px; }
        .single-post-body h2 { color: var(--accent-green); margin: 40px 0 20px; font-size: 1.8rem; }
        .single-post-body h3 { color: var(--accent-blue); margin: 30px 0 15px; font-size: 1.4rem; }
        .single-post-body ul { margin: 20px 0; padding-left: 30px; }
        .single-post-body li { margin-bottom: 10px; }

        .batch-data-card {
            background: var(--bg-secondary);
            border: 2px solid var(--accent-purple);
            border-radius: 16px;
            padding: 30px;
            margin: 30px 0;
            box-shadow: var(--glow-purple);
        }

        .batch-data-title {
            font-family: 'Space Mono', monospace;
            color: var(--accent-purple);
            font-size: 1rem;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .batch-data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
        }

        .batch-stat { text-align: center; }
        .batch-stat-value { font-size: 1.8rem; font-weight: 700; color: var(--accent-green); }
        .batch-stat-label { font-size: 0.85rem; color: var(--text-secondary); margin-top: 5px; }

        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: var(--text-secondary);
            text-decoration: none;
            margin-bottom: 30px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .back-btn:hover { color: var(--accent-green); }

        /* Owner Dashboard */
        .owner-dashboard {
            display: none;
            background: var(--bg-secondary);
            padding: 40px;
            border-radius: 20px;
            border: 2px solid var(--accent-pink);
            box-shadow: var(--glow-pink);
        }

        .owner-dashboard.active { display: block; }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--border);
        }

        .dashboard-title {
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(90deg, var(--accent-pink), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .dashboard-date {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        /* Daily Digest */
        .digest-section {
            margin-bottom: 40px;
        }

        .digest-section h3 {
            font-size: 1.3rem;
            margin-bottom: 20px;
            color: var(--accent-green);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .digest-section h3 .count {
            background: var(--accent-green);
            color: black;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .digest-card {
            background: var(--bg-tertiary);
            border: 2px solid var(--border);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 20px;
            transition: all 0.3s;
        }

        .digest-card:hover {
            border-color: var(--accent-purple);
        }

        .digest-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .digest-card-title {
            font-size: 1.2rem;
            font-weight: 700;
        }

        .digest-card-badge {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            background: var(--accent-orange);
        }

        .digest-card-preview {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
            border-left: 4px solid var(--accent-purple);
        }

        .digest-card-preview h4 {
            color: var(--accent-purple);
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .digest-card-preview p {
            color: var(--text-secondary);
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .digest-card-actions {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        /* Quick Update */
        .quick-update {
            background: var(--bg-tertiary);
            border: 2px solid var(--accent-blue);
            border-radius: 16px;
            padding: 30px;
            box-shadow: var(--glow-blue);
        }

        .quick-update h3 {
            color: var(--accent-blue);
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .quick-update p {
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .quick-input-wrapper {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .quick-input {
            flex: 1;
            padding: 16px 20px;
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 1.1rem;
            font-family: 'Work Sans', sans-serif;
        }

        .quick-input:focus {
            outline: none;
            border-color: var(--accent-blue);
        }

        .quick-input::placeholder {
            color: var(--text-muted);
        }

        /* Generated Post Preview */
        .generated-preview {
            display: none;
            background: var(--bg-secondary);
            border: 2px solid var(--accent-green);
            border-radius: 16px;
            padding: 30px;
            margin-top: 25px;
            box-shadow: var(--glow-green);
        }

        .generated-preview.active { display: block; }

        .generated-preview h4 {
            color: var(--accent-green);
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .generated-title {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 15px;
            color: var(--text-primary);
        }

        .generated-content {
            color: var(--text-secondary);
            line-height: 1.7;
            margin-bottom: 20px;
        }

        .generated-actions {
            display: flex;
            gap: 15px;
        }

        /* Buttons */
        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-pink), var(--accent-purple));
            color: white;
        }

        .btn-primary:hover { transform: scale(1.05); box-shadow: var(--glow-pink); }

        .btn-success {
            background: linear-gradient(135deg, var(--accent-green), #00cc44);
            color: black;
        }

        .btn-success:hover { transform: scale(1.05); box-shadow: var(--glow-green); }

        .btn-secondary {
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            color: var(--text-primary);
        }

        .btn-secondary:hover { border-color: var(--accent-blue); }

        .btn-generate {
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            color: white;
            padding: 16px 32px;
        }

        .btn-generate:hover { transform: scale(1.05); box-shadow: var(--glow-blue); }

        .btn-small {
            padding: 10px 20px;
            font-size: 0.9rem;
        }

        /* Login Modal */
        .login-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }

        .login-modal.active { display: flex; }

        .login-box {
            background: var(--bg-secondary);
            padding: 40px;
            border-radius: 20px;
            border: 2px solid var(--accent-purple);
            box-shadow: var(--glow-purple);
            text-align: center;
            max-width: 400px;
            width: 90%;
        }

        .login-box h2 {
            margin-bottom: 10px;
            color: var(--accent-purple);
        }

        .login-box p {
            color: var(--text-secondary);
            margin-bottom: 25px;
        }

        .login-box input {
            width: 100%;
            padding: 18px;
            margin-bottom: 20px;
            background: var(--bg-tertiary);
            border: 2px solid var(--border);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 1.5rem;
            text-align: center;
            letter-spacing: 12px;
        }

        .login-box input:focus {
            outline: none;
            border-color: var(--accent-purple);
        }

        /* Empty & Loading States */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-state-icon { font-size: 4rem; margin-bottom: 20px; }

        .loading {
            text-align: center;
            padding: 60px;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid var(--border);
            border-top-color: var(--accent-green);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        /* Pending Posts List */
        .pending-list {
            margin-top: 30px;
        }

        .pending-item {
            background: var(--bg-tertiary);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .pending-item:hover {
            border-color: var(--accent-purple);
        }

        .pending-info h4 {
            margin-bottom: 5px;
        }

        .pending-info p {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Footer */
        .footer {
            background: var(--bg-secondary);
            padding: 40px;
            text-align: center;
            border-top: 1px solid var(--border);
            margin-top: 80px;
        }

        .footer-links {
            display: flex;
            gap: 30px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .footer-links a {
            color: var(--text-secondary);
            text-decoration: none;
        }

        .footer-links a:hover { color: var(--accent-green); }

        .footer-copy {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        /* Responsive */
        @media (max-width: 900px) {
            .featured-post { grid-template-columns: 1fr; }
            .featured-post-image { min-height: 250px; }
            .featured-post-content { padding: 30px; }
            .single-post-title { font-size: 2rem; }
            .quick-input-wrapper { flex-direction: column; }
        }

        @media (max-width: 600px) {
            .header { padding: 15px 20px; }
            .header-content { flex-direction: column; gap: 15px; }
            .hero { padding: 50px 20px; }
            .hero h1 { font-size: 2rem; }
            .main { padding: 20px; }
            .blog-grid { grid-template-columns: 1fr; }
            .digest-card-actions { flex-direction: column; }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <a href="#" class="logo" onclick="showBlogList()">
                <img src="https://images.squarespace-cdn.com/content/v1/5501f606e4b0b9ba3b7be5ec/1537298893777-QBVYYWKI0KBKGYJGQJB5/WM.png?format=1500w" alt="White Mousse" class="logo-img">
                <span>SERVE THE TERPS</span>
            </a>
            <nav class="nav">
                <a href="https://whitemousse.com">Main Site</a>
                <a href="#" onclick="showBlogList()">Blog</a>
                <a href="#" class="owner-btn" onclick="showOwnerLogin()">üîê</a>
            </nav>
        </div>
    </header>

    <section class="hero" id="heroSection">
        <h1>BEHIND THE TERPS</h1>
        <p>Strain spotlights, lab insights, and the freshest drops from Colorado's premier concentrate producer.</p>
    </section>

    <main class="main">
        <!-- Blog List View -->
        <div id="blogListView">
            <div class="categories">
                <button class="category-btn active" data-category="all" onclick="filterPosts('all')">All Posts</button>
                <button class="category-btn" data-category="drops" onclick="filterPosts('drops')">New Drops</button>
                <button class="category-btn" data-category="strains" onclick="filterPosts('strains')">Strain Spotlight</button>
                <button class="category-btn" data-category="update" onclick="filterPosts('update')">Updates</button>
                <button class="category-btn" data-category="behind-scenes" onclick="filterPosts('behind-scenes')">Behind the Scenes</button>
            </div>

            <div id="featuredPost" class="featured-post" style="display: none;"></div>

            <div id="blogGrid" class="blog-grid">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p>Loading posts...</p>
                </div>
            </div>
        </div>

        <!-- Single Post View -->
        <article class="single-post" id="singlePostView"></article>

        <!-- Owner Dashboard -->
        <div class="owner-dashboard" id="ownerDashboard">
            <div class="dashboard-header">
                <h2 class="dashboard-title">üìä Daily Content Dashboard</h2>
                <div>
                    <span class="dashboard-date" id="dashboardDate"></span>
                    <button class="btn btn-secondary btn-small" style="margin-left: 15px;" onclick="showBlogList()">‚Üê Back to Blog</button>
                </div>
            </div>

            <!-- Quick Update Section -->
            <div class="quick-update">
                <h3>‚ö° Quick Update</h3>
                <p>Type a quick note and I'll turn it into an engaging post for you!</p>
                <div class="quick-input-wrapper">
                    <input type="text" class="quick-input" id="quickInput" placeholder="e.g., New vape hardware came in today, got some fire GMO...">
                    <button class="btn btn-generate" onclick="generatePost()">‚ú® Generate Post</button>
                </div>

                <div class="generated-preview" id="generatedPreview">
                    <h4>‚ú® Generated Post Preview</h4>
                    <div class="generated-title" id="generatedTitle"></div>
                    <div class="generated-content" id="generatedContent"></div>
                    <div class="generated-actions">
                        <button class="btn btn-success" onclick="publishGenerated()">üöÄ Publish Now</button>
                        <button class="btn btn-secondary" onclick="regeneratePost()">üîÑ Try Another Version</button>
                        <button class="btn btn-secondary" onclick="editGenerated()">‚úèÔ∏è Edit First</button>
                    </div>
                </div>
            </div>

            <!-- Today's Batches Section -->
            <div class="digest-section" style="margin-top: 40px;">
                <h3>üî• Today's Completed Batches <span class="count" id="batchCount">0</span></h3>
                <div id="batchDigest">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <p>Loading today's batches...</p>
                    </div>
                </div>
            </div>

            <!-- Pending Approval Section -->
            <div class="digest-section">
                <h3>üìù Pending Approval <span class="count" id="pendingCount">0</span></h3>
                <div id="pendingPosts">
                    <div class="empty-state">
                        <p>No posts pending approval</p>
                    </div>
                </div>
            </div>

            <!-- Published Today -->
            <div class="digest-section">
                <h3>‚úÖ Published Today <span class="count" id="publishedCount">0</span></h3>
                <div id="publishedToday">
                    <div class="empty-state">
                        <p>Nothing published today yet</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Owner Login Modal -->
    <div class="login-modal" id="loginModal">
        <div class="login-box">
            <h2>üîê Owner Access</h2>
            <p>Enter your PIN to access the content dashboard</p>
            <input type="password" id="ownerPin" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" maxlength="4" pattern="[0-9]*" inputmode="numeric">
            <button class="btn btn-primary" style="width: 100%;" onclick="ownerLogin()">Enter Dashboard</button>
            <button class="btn btn-secondary" style="width: 100%; margin-top: 10px;" onclick="closeLoginModal()">Cancel</button>
        </div>
    </div>

    <!-- Edit Modal -->
    <div class="login-modal" id="editModal">
        <div class="login-box" style="max-width: 600px;">
            <h2>‚úèÔ∏è Edit Post</h2>
            <input type="text" id="editTitle" placeholder="Title" style="letter-spacing: normal; font-size: 1.1rem; text-align: left; margin-bottom: 15px;">
            <textarea id="editContent" style="width: 100%; min-height: 200px; padding: 15px; background: var(--bg-tertiary); border: 2px solid var(--border); border-radius: 12px; color: var(--text-primary); font-size: 1rem; font-family: inherit; resize: vertical; margin-bottom: 15px;"></textarea>
            <div style="display: flex; gap: 15px;">
                <button class="btn btn-success" style="flex: 1;" onclick="saveAndPublish()">üöÄ Save & Publish</button>
                <button class="btn btn-secondary" style="flex: 1;" onclick="closeEditModal()">Cancel</button>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-links">
            <a href="https://whitemousse.com">Home</a>
            <a href="https://whitemousse.com/stores">Find Us</a>
            <a href="https://whitemousse.com/wholesale">Wholesale</a>
            <a href="https://instagram.com/white.mousse.concentrates">Instagram</a>
        </div>
        <p class="footer-copy">&copy; 2024 White Mousse Concentrates. Serving the terps since 2014.</p>
    </footer>

    <script>
        const SUPABASE_URL = 'https://rcbwjpfacuamwxqtwhmv.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJjYndqcGZhY3VhbXd4cXR3aG12Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU5NDA4ODAsImV4cCI6MjA2MTUxNjg4MH0.eAPPS2PzVERVXO7c8hdeSeyxLOOKCzlbJg1Nm95L6-E';
        const db = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Owner PIN - change this to your preferred PIN
        const OWNER_PIN = '0420';

        let allPosts = [];
        let currentCategory = 'all';
        let isOwnerLoggedIn = false;
        let generatedPost = null;
        let currentEditPost = null;

        // Post templates for generating engaging content
        const postTemplates = {
            equipment: [
                {
                    title: "üîß Gear Upgrade Alert!",
                    intro: "The lab just got a serious upgrade, fam!",
                    body: "We're always looking for ways to push our extraction game to the next level, and today we leveled up BIG TIME.",
                    cta: "Stay tuned for even better concentrates coming your way! üöÄ"
                },
                {
                    title: "‚ö° New Tech in the Lab",
                    intro: "When you're obsessed with quality, you never stop upgrading.",
                    body: "Just added some new firepower to our arsenal. Our extraction scientists are geeking out hard right now.",
                    cta: "Better equipment = better terps. Simple as that. üíØ"
                }
            ],
            newStrain: [
                {
                    title: "üî• Fresh Heat Incoming",
                    intro: "The terp hunters have spoken, and we listened!",
                    body: "Just got our hands on some absolutely incredible material. The nose on this one is INSANE.",
                    cta: "Keep your eyes peeled at your local dispensary! üëÄ"
                },
                {
                    title: "üåü Strain Alert!",
                    intro: "Sometimes a strain walks in and you just KNOW it's gonna be special.",
                    body: "The terpene profile on this one is chef's kiss. We're talking layers on layers of flavor.",
                    cta: "Coming soon to a dispo near you! üèÉ‚Äç‚ôÇÔ∏è"
                }
            ],
            general: [
                {
                    title: "üì£ What's Good, Fam!",
                    intro: "Just had to hop on and share what's happening at the lab today!",
                    body: "You know we're always cooking up something special for you.",
                    cta: "More updates coming soon. Stay lifted! ‚úåÔ∏è"
                },
                {
                    title: "üéØ Lab Update",
                    intro: "Another day, another chance to serve the terps!",
                    body: "Things are moving fast over here and we're excited to share.",
                    cta: "Thanks for rocking with White Mousse! üíö"
                }
            ],
            batch: [
                {
                    title: "üß™ Fresh Batch Alert!",
                    intro: "The extractors have been BUSY!",
                    body: "Just wrapped up a beautiful run and the results speak for themselves.",
                    cta: "Ask your budtender about White Mousse! üî•"
                },
                {
                    title: "üíé Quality Check: PASSED",
                    intro: "Another batch, another banger.",
                    body: "When you prioritize terps and quality, the results are always fire.",
                    cta: "Keep an eye out at your local spot! üëÄ"
                }
            ]
        };

        const excitingWords = ['absolutely fire', 'incredible', 'next level', 'game-changing', 'beautiful', 'insane', 'chef\'s kiss', 'dialed in', 'premium', 'top shelf'];
        const emojis = ['üî•', 'üíé', '‚ú®', 'üöÄ', 'üíØ', '‚ö°', 'üåü', 'üéØ', 'üíö', 'üß™'];

        document.addEventListener('DOMContentLoaded', async () => {
            await loadPosts();
            document.getElementById('dashboardDate').textContent = new Date().toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' });
        });

        async function loadPosts() {
            try {
                const { data, error } = await db
                    .from('wm_blog_posts')
                    .select('*')
                    .eq('status', 'published')
                    .order('created_at', { ascending: false });

                if (error) throw error;
                allPosts = data || [];
                renderPosts();
            } catch (error) {
                console.error('Error loading posts:', error);
                showSamplePosts();
            }
        }

        function showSamplePosts() {
            allPosts = [
                {
                    id: 1,
                    title: "üî• Fresh Drop: GMO Cookies Live Resin",
                    excerpt: "The garlic queen has arrived! Our latest GMO batch is absolutely dripping with terps.",
                    content: "We're hyped to announce our newest drop...",
                    category: "drops",
                    emoji: "üî•",
                    created_at: new Date().toISOString()
                },
                {
                    id: 2,
                    title: "üçä Strain Spotlight: Tropicana Cookies",
                    excerpt: "When life gives you oranges, you make the most flavorful live resin Colorado has ever seen.",
                    category: "strains",
                    emoji: "üçä",
                    created_at: new Date(Date.now() - 86400000).toISOString()
                },
                {
                    id: 3,
                    title: "‚ö° New Extraction Tech in the Lab",
                    excerpt: "We just upgraded our game in a major way. Better equipment means better terps for you!",
                    category: "update",
                    emoji: "‚ö°",
                    created_at: new Date(Date.now() - 172800000).toISOString()
                }
            ];
            renderPosts();
        }

        function renderPosts() {
            const grid = document.getElementById('blogGrid');
            const featuredContainer = document.getElementById('featuredPost');

            const filtered = currentCategory === 'all' ? allPosts : allPosts.filter(p => p.category === currentCategory);

            if (filtered.length === 0) {
                grid.innerHTML = `<div class="empty-state" style="grid-column: 1 / -1;"><div class="empty-state-icon">üìù</div><h3>No posts yet</h3><p>Check back soon!</p></div>`;
                featuredContainer.style.display = 'none';
                return;
            }

            const featured = filtered[0];
            featuredContainer.style.display = 'grid';
            featuredContainer.innerHTML = `
                <div class="featured-post-image">${featured.emoji || 'üî•'}</div>
                <div class="featured-post-content">
                    <div class="featured-label">‚ú® LATEST</div>
                    <h2 class="featured-post-title">${featured.title}</h2>
                    <p class="featured-post-excerpt">${featured.excerpt}</p>
                    <a href="#" class="read-more-btn" onclick="showPost(${featured.id}); return false;">Read More ‚Üí</a>
                </div>`;

            const rest = filtered.slice(1);
            grid.innerHTML = rest.length === 0 ? '' : rest.map(post => `
                <article class="blog-card" onclick="showPost(${post.id})">
                    <div class="blog-card-image">
                        ${post.emoji || 'üìù'}
                        <span class="blog-card-category ${post.category}">${formatCategory(post.category)}</span>
                    </div>
                    <div class="blog-card-content">
                        <h3 class="blog-card-title">${post.title}</h3>
                        <p class="blog-card-excerpt">${post.excerpt}</p>
                        <div class="blog-card-meta">
                            <span>White Mousse</span>
                            <span>${formatDate(post.created_at)}</span>
                        </div>
                    </div>
                </article>`).join('');
        }

        function filterPosts(category) {
            currentCategory = category;
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.category === category);
            });
            renderPosts();
        }

        function showPost(postId) {
            const post = allPosts.find(p => p.id === postId);
            if (!post) return;

            document.getElementById('blogListView').style.display = 'none';
            document.getElementById('heroSection').style.display = 'none';
            document.getElementById('ownerDashboard').classList.remove('active');

            const postView = document.getElementById('singlePostView');
            postView.classList.add('active');
            postView.innerHTML = `
                <a href="#" class="back-btn" onclick="showBlogList(); return false;">‚Üê Back to all posts</a>
                <header class="single-post-header">
                    <span class="single-post-category">${formatCategory(post.category)}</span>
                    <h1 class="single-post-title">${post.title}</h1>
                    <div class="single-post-meta">
                        <span>White Mousse Team</span>
                        <span>‚Ä¢</span>
                        <span>${formatDate(post.created_at)}</span>
                    </div>
                </header>
                <div class="single-post-body">${formatContent(post.content)}</div>`;
            window.scrollTo(0, 0);
        }

        function showBlogList() {
            document.getElementById('blogListView').style.display = 'block';
            document.getElementById('heroSection').style.display = 'block';
            document.getElementById('singlePostView').classList.remove('active');
            document.getElementById('ownerDashboard').classList.remove('active');
        }

        // Owner Functions
        function showOwnerLogin() {
            document.getElementById('loginModal').classList.add('active');
            document.getElementById('ownerPin').focus();
        }

        function closeLoginModal() {
            document.getElementById('loginModal').classList.remove('active');
            document.getElementById('ownerPin').value = '';
        }

        function ownerLogin() {
            const pin = document.getElementById('ownerPin').value;
            if (pin === OWNER_PIN) {
                isOwnerLoggedIn = true;
                closeLoginModal();
                showOwnerDashboard();
            } else {
                alert('Invalid PIN');
            }
        }

        async function showOwnerDashboard() {
            document.getElementById('blogListView').style.display = 'none';
            document.getElementById('heroSection').style.display = 'none';
            document.getElementById('singlePostView').classList.remove('active');
            document.getElementById('ownerDashboard').classList.add('active');

            await loadTodaysBatches();
            await loadPendingPosts();
            await loadPublishedToday();
        }

        async function loadTodaysBatches() {
            const container = document.getElementById('batchDigest');
            const countEl = document.getElementById('batchCount');

            try {
                const today = new Date();
                today.setHours(0, 0, 0, 0);

                const { data: batches, error } = await db
                    .from('wm_batches')
                    .select('*')
                    .eq('status', 'complete')
                    .gte('updated_at', today.toISOString())
                    .order('updated_at', { ascending: false });

                if (error) throw error;

                countEl.textContent = batches?.length || 0;

                if (!batches || batches.length === 0) {
                    container.innerHTML = `<div class="empty-state"><p>No batches completed today yet. Check back later!</p></div>`;
                    return;
                }

                container.innerHTML = batches.map(batch => {
                    const autoDraft = generateBatchPost(batch);
                    return `
                        <div class="digest-card">
                            <div class="digest-card-header">
                                <div class="digest-card-title">üß™ ${batch.strain || 'Unknown Strain'} - Batch ${batch.batch_id}</div>
                                <span class="digest-card-badge">Auto-Draft Ready</span>
                            </div>
                            <div style="color: var(--text-secondary); margin-bottom: 15px;">
                                Completed ${formatTime(batch.updated_at)} ‚Ä¢ ${batch.final_yield || '?'}g yield ‚Ä¢ ${batch.yield_percentage || '?'}% efficiency
                            </div>
                            <div class="digest-card-preview">
                                <h4>üìù Auto-Generated Post</h4>
                                <p><strong>${autoDraft.title}</strong></p>
                                <p style="margin-top: 10px;">${autoDraft.excerpt}</p>
                            </div>
                            <div class="digest-card-actions">
                                <button class="btn btn-success btn-small" onclick="publishBatchPost('${batch.id}')">‚úÖ Approve & Publish</button>
                                <button class="btn btn-secondary btn-small" onclick="editBatchPost('${batch.id}')">‚úèÔ∏è Edit First</button>
                                <button class="btn btn-secondary btn-small" onclick="skipBatch('${batch.id}')">Skip</button>
                            </div>
                        </div>`;
                }).join('');

            } catch (error) {
                console.error('Error loading batches:', error);
                container.innerHTML = `<div class="empty-state"><p>Could not load batches</p></div>`;
                countEl.textContent = '0';
            }
        }

        function generateBatchPost(batch) {
            const template = postTemplates.batch[Math.floor(Math.random() * postTemplates.batch.length)];
            const word = excitingWords[Math.floor(Math.random() * excitingWords.length)];
            const emoji = emojis[Math.floor(Math.random() * emojis.length)];

            return {
                title: `${emoji} Fresh ${batch.strain || 'Fire'} Just Dropped!`,
                excerpt: `${template.intro} Our latest ${batch.strain || 'batch'} run is ${word}. ${batch.final_yield}g of pure terpy goodness. ${template.cta}`,
                content: `${template.intro}\n\n${template.body}\n\n**Strain:** ${batch.strain || 'N/A'}\n**Yield:** ${batch.final_yield}g\n**Efficiency:** ${batch.yield_percentage || 'N/A'}%\n\n${template.cta}`,
                category: 'drops',
                emoji: emoji,
                batch_id: batch.id
            };
        }

        async function publishBatchPost(batchId) {
            try {
                const { data: batch } = await db.from('wm_batches').select('*').eq('id', batchId).single();
                const post = generateBatchPost(batch);

                const { error } = await db.from('wm_blog_posts').insert([{
                    ...post,
                    status: 'published',
                    created_at: new Date().toISOString()
                }]);

                if (error) throw error;

                alert('Post published! üöÄ');
                await loadPosts();
                await loadTodaysBatches();
                await loadPublishedToday();
            } catch (error) {
                console.error('Error publishing:', error);
                alert('Error publishing post');
            }
        }

        async function editBatchPost(batchId) {
            const { data: batch } = await db.from('wm_batches').select('*').eq('id', batchId).single();
            const post = generateBatchPost(batch);

            currentEditPost = { ...post, batch_id: batchId };
            document.getElementById('editTitle').value = post.title;
            document.getElementById('editContent').value = post.content;
            document.getElementById('editModal').classList.add('active');
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.remove('active');
            currentEditPost = null;
        }

        async function saveAndPublish() {
            if (!currentEditPost) return;

            try {
                const title = document.getElementById('editTitle').value;
                const content = document.getElementById('editContent').value;

                const { error } = await db.from('wm_blog_posts').insert([{
                    title,
                    content,
                    excerpt: content.split('\n')[0].slice(0, 150) + '...',
                    category: currentEditPost.category || 'update',
                    emoji: currentEditPost.emoji || 'üî•',
                    batch_id: currentEditPost.batch_id,
                    status: 'published',
                    created_at: new Date().toISOString()
                }]);

                if (error) throw error;

                closeEditModal();
                alert('Post published! üöÄ');
                await loadPosts();
                await loadTodaysBatches();
                await loadPublishedToday();
            } catch (error) {
                console.error('Error:', error);
                alert('Error publishing');
            }
        }

        // Quick Update Generator
        function generatePost() {
            const input = document.getElementById('quickInput').value.trim();
            if (!input) {
                alert('Type something first!');
                return;
            }

            // Detect what type of update this is
            let templateType = 'general';
            const lowerInput = input.toLowerCase();

            if (lowerInput.includes('hardware') || lowerInput.includes('equipment') || lowerInput.includes('new') && (lowerInput.includes('machine') || lowerInput.includes('tech'))) {
                templateType = 'equipment';
            } else if (lowerInput.includes('strain') || lowerInput.includes('flower') || lowerInput.includes('material') || lowerInput.includes('gmo') || lowerInput.includes('cookies') || lowerInput.includes('og')) {
                templateType = 'newStrain';
            } else if (lowerInput.includes('batch') || lowerInput.includes('run') || lowerInput.includes('extract')) {
                templateType = 'batch';
            }

            const templates = postTemplates[templateType];
            const template = templates[Math.floor(Math.random() * templates.length)];
            const word = excitingWords[Math.floor(Math.random() * excitingWords.length)];
            const emoji = emojis[Math.floor(Math.random() * emojis.length)];

            // Generate engaging post from brief input
            const title = template.title.replace('!', `: ${capitalizeFirst(extractKeywords(input))}!`);
            const content = `${template.intro}

${expandInput(input, word)}

${template.body}

${template.cta}`;

            generatedPost = {
                title,
                content,
                excerpt: `${template.intro} ${expandInput(input, word).slice(0, 100)}...`,
                category: templateType === 'equipment' ? 'update' : templateType === 'newStrain' ? 'strains' : 'update',
                emoji
            };

            document.getElementById('generatedTitle').textContent = title;
            document.getElementById('generatedContent').innerHTML = formatContent(content);
            document.getElementById('generatedPreview').classList.add('active');
        }

        function extractKeywords(input) {
            const words = input.split(' ').filter(w => w.length > 3);
            return words.slice(0, 3).join(' ');
        }

        function expandInput(input, word) {
            const expansions = [
                `So here's the deal: ${input}. And let me tell you, it's ${word}!`,
                `Big news from the lab: ${input}. We're honestly so hyped about this one.`,
                `Had to share this with y'all: ${input}. The quality is ${word}.`,
                `Quick update for the fam: ${input}. You already know we keep it ${word}.`
            ];
            return expansions[Math.floor(Math.random() * expansions.length)];
        }

        function capitalizeFirst(str) {
            return str.charAt(0).toUpperCase() + str.slice(1);
        }

        function regeneratePost() {
            generatePost();
        }

        function editGenerated() {
            if (!generatedPost) return;
            currentEditPost = generatedPost;
            document.getElementById('editTitle').value = generatedPost.title;
            document.getElementById('editContent').value = generatedPost.content;
            document.getElementById('editModal').classList.add('active');
        }

        async function publishGenerated() {
            if (!generatedPost) return;

            try {
                const { error } = await db.from('wm_blog_posts').insert([{
                    ...generatedPost,
                    status: 'published',
                    created_at: new Date().toISOString()
                }]);

                if (error) throw error;

                document.getElementById('quickInput').value = '';
                document.getElementById('generatedPreview').classList.remove('active');
                generatedPost = null;

                alert('Post published! üöÄ');
                await loadPosts();
                await loadPublishedToday();
            } catch (error) {
                console.error('Error:', error);
                alert('Error publishing');
            }
        }

        async function loadPendingPosts() {
            const container = document.getElementById('pendingPosts');
            const countEl = document.getElementById('pendingCount');

            try {
                const { data, error } = await db
                    .from('wm_blog_posts')
                    .select('*')
                    .eq('status', 'pending')
                    .order('created_at', { ascending: false });

                if (error) throw error;

                countEl.textContent = data?.length || 0;

                if (!data || data.length === 0) {
                    container.innerHTML = `<div class="empty-state"><p>No posts pending approval</p></div>`;
                    return;
                }

                container.innerHTML = data.map(post => `
                    <div class="pending-item">
                        <div class="pending-info">
                            <h4>${post.title}</h4>
                            <p>${formatDate(post.created_at)}</p>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-success btn-small" onclick="approvePost('${post.id}')">Approve</button>
                            <button class="btn btn-secondary btn-small" onclick="deletePost('${post.id}')">Delete</button>
                        </div>
                    </div>`).join('');
            } catch (error) {
                container.innerHTML = `<div class="empty-state"><p>Could not load pending posts</p></div>`;
            }
        }

        async function loadPublishedToday() {
            const container = document.getElementById('publishedToday');
            const countEl = document.getElementById('publishedCount');

            try {
                const today = new Date();
                today.setHours(0, 0, 0, 0);

                const { data, error } = await db
                    .from('wm_blog_posts')
                    .select('*')
                    .eq('status', 'published')
                    .gte('created_at', today.toISOString())
                    .order('created_at', { ascending: false });

                if (error) throw error;

                countEl.textContent = data?.length || 0;

                if (!data || data.length === 0) {
                    container.innerHTML = `<div class="empty-state"><p>Nothing published today yet</p></div>`;
                    return;
                }

                container.innerHTML = data.map(post => `
                    <div class="pending-item">
                        <div class="pending-info">
                            <h4>${post.emoji || 'üìù'} ${post.title}</h4>
                            <p>Published ${formatTime(post.created_at)}</p>
                        </div>
                        <button class="btn btn-secondary btn-small" onclick="showPost(${post.id})">View</button>
                    </div>`).join('');
            } catch (error) {
                container.innerHTML = `<div class="empty-state"><p>Could not load posts</p></div>`;
            }
        }

        async function approvePost(postId) {
            try {
                const { error } = await db.from('wm_blog_posts').update({ status: 'published' }).eq('id', postId);
                if (error) throw error;
                await loadPosts();
                await loadPendingPosts();
                await loadPublishedToday();
            } catch (error) {
                alert('Error approving post');
            }
        }

        async function deletePost(postId) {
            if (!confirm('Delete this post?')) return;
            try {
                const { error } = await db.from('wm_blog_posts').delete().eq('id', postId);
                if (error) throw error;
                await loadPendingPosts();
            } catch (error) {
                alert('Error deleting post');
            }
        }

        function skipBatch(batchId) {
            document.querySelector(`[onclick*="${batchId}"]`).closest('.digest-card').style.display = 'none';
        }

        // Utility functions
        function formatDate(dateStr) {
            return new Date(dateStr).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        }

        function formatTime(dateStr) {
            return new Date(dateStr).toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
        }

        function formatCategory(cat) {
            const names = { 'drops': 'New Drop', 'strains': 'Strain Spotlight', 'update': 'Update', 'behind-scenes': 'Behind the Scenes', 'news': 'News' };
            return names[cat] || cat;
        }

        function formatContent(content) {
            if (!content) return '';
            return content.split('\n\n').map(p => {
                if (p.startsWith('## ')) return `<h2>${p.slice(3)}</h2>`;
                if (p.startsWith('**') && p.includes(':**')) return `<p><strong>${p.replace(/\*\*/g, '')}</strong></p>`;
                if (p.startsWith('- ')) return `<ul>${p.split('\n').map(i => `<li>${i.slice(2)}</li>`).join('')}</ul>`;
                return `<p>${p}</p>`;
            }).join('');
        }

        // Event listeners
        document.getElementById('ownerPin').addEventListener('keypress', e => { if (e.key === 'Enter') ownerLogin(); });
        document.getElementById('quickInput').addEventListener('keypress', e => { if (e.key === 'Enter') generatePost(); });
    </script>

    <script type="application/ld+json">
    {"@context":"https://schema.org","@type":"Blog","name":"White Mousse Blog","description":"Behind the scenes at White Mousse Concentrates","url":"https://blog.whitemousse.com","publisher":{"@type":"Organization","name":"White Mousse Concentrates"}}
    </script>
</body>
</html>
